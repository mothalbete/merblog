<div class="dash-perfil vapor-card">

    <!-- MENSAJE DE ERROR DE PERFIL -->
    <% if (typeof errorPerfil !== "undefined" && errorPerfil) { %>
        <p class="error-msg"><%= errorPerfil %></p>
    <% } %>

    <!-- DATOS DEL USUARIO -->
    <div class="perfil-header-vapor">

        <h2 class="vapor-title">@<%= user.username %></h2>

        <p class="perfil-info">
            Email: <span><%= user.email || "No especificado" %></span>
        </p>

        <p class="perfil-info">
            Biografía: <span><%= user.biografia || "Sin biografía" %></span>
        </p>

        <!-- CONTADORES -->
        <div class="perfil-contadores">
            <p><strong>Seguidores:</strong> <%= seguidoresCount %></p>
            <p><strong>Seguidos:</strong> <%= seguidosCount %></p>
            <p><strong>Publicaciones:</strong> <%= misPublicaciones.length %></p>
        </div>

        <button class="btn btn-primary btn-editar-perfil" onclick="openPerfilModal()">
            Editar perfil
        </button>
    </div>

    <h3 class="perfil-subtitle">Mis publicaciones</h3>

    <div class="mis-publicaciones-grid-vapor">

        <% if (misPublicaciones.length === 0) { %>
            <p class="perfil-no-pubs">No has publicado nada todavía.</p>
        <% } %>

        <% misPublicaciones.forEach(function(pub) { %>

            <div class="mi-card-vapor" data-id="<%= pub.id_publicacion %>">

                <img src="<%= pub.imagen %>" alt="Mi publicación">

                <div class="mi-card-title">

                    <%= pub.titulo %>

                    <!-- BOTÓN EDITAR -->
                    <button type="button"
                            class="btn-edit-small"
                            onclick="event.stopPropagation(); abrirModalEditar('<%= pub.id_publicacion %>')">
                        Editar
                    </button>

                    <!-- BOTÓN ELIMINAR -->
                    <form action="/publicaciones/<%= pub.id_publicacion %>/eliminar"
                          method="POST"
                          class="delete-form"
                          onclick="event.stopPropagation();"
                          onsubmit="return confirm('¿Seguro que quieres eliminar esta publicación?');">
                        <button type="submit" class="btn-delete-small">Eliminar</button>
                    </form>

                </div>

            </div>

        <% }) %>

    </div>

</div>

<script>
    // Abrir modal de lectura al hacer clic en una tarjeta
    document.querySelectorAll('.mi-card-vapor').forEach(function(card) {
        card.addEventListener('click', function() {
            var id = card.dataset.id;
            cargarPublicacion(id);
            abrirModal();
        });
    });
</script>
